# Benchmarks summary and conslusions (2022-11-04)

This benchmarking session was focused on the deltaprime Use Case. We assume that there will be 3 required signers and from 1 to 20 requested symbols.

I also wanted to explore the problem with memory expansion, si I measured how much memory we use while calling the `getOracleNumericValuesFromTxMsg` function

## Memory usage of our oracle function

We will not consume more than 20K bytes of memory

```js
{
  "3 signers, 1 symbols, 1 points": 2247,
  "3 signers, 1 symbols, 20 points": 9543,
  "3 signers, 2 symbols, 1 points": 4110,
  "3 signers, 2 symbols, 20 points": 10023,
  "3 signers, 3 symbols, 1 points": 5973,
  "3 signers, 3 symbols, 20 points": 10503,
  "3 signers, 5 symbols, 1 points": 9699,
  "3 signers, 5 symbols, 20 points": 11463,
  "3 signers, 10 symbols, 1 points": 19014,
  "3 signers, 20 symbols, 1 points": 37644,
  "3 signers, 20 symbols, 20 points": 18663,
}
```

Idea! Maybe we can overwrite the free memory pointer to the previous value after all our activities (like signature verification etc.) to optimise gas. I will implement an experiment for it as well.

## Gas costs with and without additional memory expansion

As we thought previous memory expansion can influcence the gas costs of the `getOracleNumericValuesFromTxMsg` function

### Without additional memory expansion

```js
  "3 signers, 1 symbols, 1 points": {
    "forAttachingDataToCalldata": 4944,
    "forDataExtractionAndVerification": 28730
  },
  "3 signers, 2 symbols, 1 points": {
    "forAttachingDataToCalldata": 9588,
    "forDataExtractionAndVerification": 54182
  },
  "3 signers, 5 symbols, 1 points": {
    "forAttachingDataToCalldata": 23604,
    "forDataExtractionAndVerification": 134075
  },
  "3 signers, 20 symbols, 20 points": {
    "forAttachingDataToCalldata": 26712,
    "forDataExtractionAndVerification": 274834
  },
```

### With additional 10kb memory expansion

```js
  "3 signers, 1 symbols, 1 points": {
    "forAttachingDataToCalldata": 4944,
    "forDataExtractionAndVerification": 28780
  },
  "3 signers, 2 symbols, 1 points": {
    "forAttachingDataToCalldata": 9588,
    "forDataExtractionAndVerification": 54302
  },
  "3 signers, 5 symbols, 1 points": {
    "forAttachingDataToCalldata": 23604,
    "forDataExtractionAndVerification": 134410
  },
  "3 signers, 20 symbols, 20 points": {
    "forAttachingDataToCalldata": 26712,
    "forDataExtractionAndVerification": 275513
  },
```

### With additional 300kb memory expansion

Additional 300kb memory allocation **significantly** increases the gas costs of data extraction and verification

```js
  "3 signers, 1 symbols, 1 points": {
    "forAttachingDataToCalldata": 4944,
    "forDataExtractionAndVerification": 231205
  },
  "3 signers, 2 symbols, 1 points": {
    "forAttachingDataToCalldata": 9588,
    "forDataExtractionAndVerification": 258780
  },
  "3 signers, 5 symbols, 1 points": {
    "forAttachingDataToCalldata": 23604,
    "forDataExtractionAndVerification": 345082
  },
  "3 signers, 20 symbols, 20 points": {
    "forAttachingDataToCalldata": 26712,
    "forDataExtractionAndVerification": 496095
  },
```

## My conslusions

Although deltaprime uses a lot functionality of having multiple asset prices in the same transaction, I would receommend our clinets in future to minimise the number of requested feeds in a single transaction.
